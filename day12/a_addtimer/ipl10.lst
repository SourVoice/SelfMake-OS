     1 00000000                                 ;os-loader
     2 00000000                                 ;Tab = 4
     3  = 0000000A                                      CYLS    equ     10
     4                                                  ORG     0x7c00              ;程序加载至0x7c00处(现在这里的ORG是一个相对的偏移量了,并不真正指物理地址)
     5 00007C00 EB 4E                                   jmp     entry               
     6 00007C02                                 ;模拟FAT12格式软盘，模拟其内存分区机制
     7 00007C02 90                                      db      0x90
     8 00007C03 48 45 4C 4C 4F 49 50 4C                 db      "HELLOIPL"         
     9 00007C0B 0200                                    dw      512                 
    10 00007C0D 01                                      db      1                   
    11 00007C0E 0001                                    dw      1                   
    12 00007C10 02                                      db      2                   
    13 00007C11 00E0                                    dw      224                 
    14 00007C13 0B40                                    dw      2880                
    15 00007C15 F0                                      db      0xf0                
    16 00007C16 0009                                    dw      9                   
    17 00007C18 0012                                    dw      18                  
    18 00007C1A 0002                                    dw      2                   
    19 00007C1C 00000000                                dd      0                   
    20 00007C20 00000B40                                dd      2880                
    21 00007C24 00 00 29                                db      0,0,0x29            
    22 00007C27 FFFFFFFF                                dd      0xffffffff          
    23 00007C2B 48 45 4C 4C 4F 2D 4F 53 20 20           db      "HELLO-OS   "       
       00007C35 20 
    24 00007C36 46 41 54 31 32 20 20 20                 db      "FAT12   "             
    25 00007C3E 00 00 00 00 00 00 00 00 00 00           RESB    18                  
       00007C48 00 00 00 00 00 00 00 00 
    26 00007C50                                 ;程序核心
    27 00007C50                                     entry:
    28 00007C50 B8 0000                                 MOV     AX,0                
    29 00007C53 8E D0                                   MOV     ss,AX
    30 00007C55 BC 7C00                                 MOV     sp,0x7c00           
    31 00007C58 8E D8                                   MOV     DS,AX
    32 00007C5A 8E C0                                   MOV     es,AX
    33 00007C5C                                               
    34 00007C5C                                         ;读盘(全2-18扇区)
    35 00007C5C B8 0820                                 MOV     AX,0x0820           
    36 00007C5F 8E C0                                   MOV     ES,AX               
    37 00007C61 B5 00                                   MOV     CH,0                ;柱面标号从0开始 
    38 00007C63 B6 00                                   MOV     DH,0                               
    39 00007C65 B1 02                                   MOV     CL,2                ;从第二扇区写入IPL
    40 00007C67                                     readloop:
    41 00007C67 BE 0000                                 MOV     si,0
    42 00007C6A                                     retry:
    43 00007C6A B4 02                                   MOV     AH,0x02             
    44 00007C6C B0 01                                   MOV     AL,1                
    45 00007C6E BB 0000                                 MOV     BX,0                
    46 00007C71 B2 00                                   MOV     DL,0x00             
    47 00007C73 CD 13                                   INT     0x13                
    48 00007C75 73 10                                   jnc     next                
    49 00007C77                                         ;该扇区读取错误
    50 00007C77 83 C6 01                                add     si,1                
    51 00007C7A 83 FE 05                                cmp     si,5               
    52 00007C7D 73 42                                   jae     error              
    53 00007C7F B4 00                                   MOV     AH,0x00            
    54 00007C81 B2 00                                   MOV     DL,0x00            
    55 00007C83 CD 13                                   INT     0x13                
    56 00007C85 EB E3                                   jmp     retry              
    57 00007C87                                     next:
    58 00007C87 8C C0                                   MOV     AX,ES              
    59 00007C89 05 0020                                 add     ax,0x0020           
    60 00007C8C 8E C0                                   MOV     ES,AX               
    61 00007C8E 80 C1 01                                add     CL,1                
    62 00007C91 80 F9 12                                cmp     CL,18              
    63 00007C94 76 D1                                   jbe     readloop      
    64 00007C96                                         ;反面
    65 00007C96 B1 01                                   MOV     CL,1                
    66 00007C98 80 C6 01                                ADD     DH,1                
    67 00007C9B 80 FE 02                                cmp     DH,2                
    68 00007C9E 72 C7                                   jb      readloop            
    69 00007CA0                                         ;读取柱面
    70 00007CA0 B6 00                                   MOV     DH,0                
    71 00007CA2 80 C5 01                                ADD     CH,1               
    72 00007CA5 80 FD 0A                                cmp     CH,CYLS             
    73 00007CA8 72 BD                                   jb      readloop
    74 00007CAA                                     success:
    75 00007CAA 0A 0A                                   DB      0x0a,0x0a
    76 00007CAC 45 4E 54 45 52 20 74 68 65 20           db      "ENTER the OS"
       00007CB6 4F 53 
    77 00007CB8 0A                                      db      0x0a
    78 00007CB9 00                                      db      0
    79 00007CBA                                         ; begin to execute os from boot sector
    80 00007CBA 88 2E 0FF0                              mov     [0xff0], ch         
    81 00007CBE E9 453F                                 jmp     0xc200              
    82 00007CC1                                     error:
    83 00007CC1 BE 7CD9                                 MOV     si,MSG
    84 00007CC4                                     putloop:
    85 00007CC4 8A 04                                   MOV     al,[si]         
    86 00007CC6 83 C6 01                                add     si,1
    87 00007CC9 3C 00                                   cmp     al,0           
    88 00007CCB                                 
    89 00007CCB 74 09                                   je      fin
    90 00007CCD B4 0E                                   MOV     AH,0x0e        
    91 00007CCF BB 000F                                 MOV     bx,15          
    92 00007CD2 CD 10                                   INT     0x10           
    93 00007CD4 EB EE                                   jmp     putloop
    94 00007CD6                                     fin:
    95 00007CD6 F4                                      HLT
    96 00007CD7 EB FD                                   jmp     fin
    97 00007CD9                                     MSG:
    98 00007CD9 0A 0A                                   DB      0x0a,0x0a
    99 00007CDB 4C 4F 41 44 20 45 52 52 4F 52           db      "LOAD ERROR"
   100 00007CE5 0A                                      db      0x0a
   101 00007CE6 00                                      db      0
   102 00007CE7                                         ;判断终止启动区
   103 00007CE7 00 00 00 00 00 00 00 00 00 00           RESB    0x7dfe-$          
       00007CF1 00 00 00 00 00 00 00 00 00 00 
       00007CFB 00 00 00 00 00 00 00 00 00 00 
       00007D05 00 00 00 00 00 00 00 00 00 00 
       00007D0F 00 00 00 00 00 00 00 00 00 00 
       00007D19 00 00 00 00 00 00 00 00 00 00 
       00007D23 00 00 00 00 00 00 00 00 00 00 
       00007D2D 00 00 00 00 00 00 00 00 00 00 
       00007D37 00 00 00 00 00 00 00 00 00 00 
       00007D41 00 00 00 00 00 00 00 00 00 00 
       00007D4B 00 00 00 00 00 00 00 00 00 00 
       00007D55 00 00 00 00 00 00 00 00 00 00 
       00007D5F 00 00 00 00 00 00 00 00 00 00 
       00007D69 00 00 00 00 00 00 00 00 00 00 
       00007D73 00 00 00 00 00 00 00 00 00 00 
       00007D7D 00 00 00 00 00 00 00 00 00 00 
       00007D87 00 00 00 00 00 00 00 00 00 00 
       00007D91 00 00 00 00 00 00 00 00 00 00 
       00007D9B 00 00 00 00 00 00 00 00 00 00 
       00007DA5 00 00 00 00 00 00 00 00 00 00 
       00007DAF 00 00 00 00 00 00 00 00 00 00 
       00007DB9 00 00 00 00 00 00 00 00 00 00 
       00007DC3 00 00 00 00 00 00 00 00 00 00 
       00007DCD 00 00 00 00 00 00 00 00 00 00 
       00007DD7 00 00 00 00 00 00 00 00 00 00 
       00007DE1 00 00 00 00 00 00 00 00 00 00 
       00007DEB 00 00 00 00 00 00 00 00 00 00 
       00007DF5 00 00 00 00 00 00 00 00 00 
   104 00007DFE 55 AA                                   db      0x55,0xaa           