     1 00000000                                 ;os-loader
     2 00000000                                 ;Tab = 4
     3  = 0000000A                                      CYLS    equ     10
     4                                                  ORG     0x7c00              ;程序加载至0x7c00处(现在这里的ORG是一个相对的偏移量了,并不真正指物理地址)
     5 00007C00 EB 4B                                   jmp     entry               
     6 00007C02                                 ;模拟FAT12格式软盘，模拟其内存分区机制
     7 00007C02 90                                      db      0x90
     8 00007C03 48 45 4C 4C 4F 49 50 4C                 db      "HELLOIPL"         
     9 00007C0B 0200                                    dw      512                 
    10 00007C0D 01                                      db      1                   
    11 00007C0E 0001                                    dw      1                   
    12 00007C10 02                                      db      2                   
    13 00007C11 00E0                                    dw      224                 
    14 00007C13 0B40                                    dw      2880                
    15 00007C15 F0                                      db      0xf0                
    16 00007C16 0009                                    dw      9                   
    17 00007C18 0012                                    dw      18                  
    18 00007C1A 0002                                    dw      2                   
    19 00007C1C 00000000                                dd      0                   
    20 00007C20 00000B40                                dd      2880                
    21 00007C24 00 00 29                                db      0,0,0x29            
    22 00007C27 FFFFFFFF                                dd      0xffffffff          
    23 00007C2B 48 45 4C 4C 4F 2D 4F 53 20 20           db      "HELLO-OS   "       
       00007C35 20 
    24 00007C36 46 41 54 31 32                          db      "FAT12"             
    25 00007C3B 00 00 00 00 00 00 00 00 00 00           RESB    18                  
       00007C45 00 00 00 00 00 00 00 00 
    26 00007C4D                                 ;程序核心
    27 00007C4D                                     entry:
    28 00007C4D B8 0000                                 MOV     AX,0                
    29 00007C50 8E D0                                   MOV     ss,AX
    30 00007C52 BC 7C00                                 MOV     sp,0x7c00           
    31 00007C55 8E D8                                   MOV     DS,AX
    32 00007C57 8E C0                                   MOV     es,AX
    33 00007C59                                               
    34 00007C59                                         ;读盘(全2-18扇区)
    35 00007C59 B8 0820                                 MOV     AX,0x0820           
    36 00007C5C 8E C0                                   MOV     ES,AX               
    37 00007C5E B5 00                                   MOV     CH,0                ;柱面标号从0开始 
    38 00007C60 B6 00                                   MOV     DH,0                               
    39 00007C62 B1 02                                   MOV     CL,2                ;从第二扇区写入IPL
    40 00007C64                                     readloop:
    41 00007C64 BE 0000                                 MOV     si,0
    42 00007C67                                     retry:
    43 00007C67 B4 02                                   MOV     AH,0x02             
    44 00007C69 B0 01                                   MOV     AL,1                
    45 00007C6B BB 0000                                 MOV     BX,0                
    46 00007C6E B2 00                                   MOV     DL,0x00             
    47 00007C70 CD 13                                   INT     0x13                
    48 00007C72 73 10                                   jnc     next                
    49 00007C74                                         ;该扇区读取错误
    50 00007C74 83 C6 01                                add     si,1                
    51 00007C77 83 FE 05                                cmp     si,5               
    52 00007C7A 73 42                                   jae     error              
    53 00007C7C B4 00                                   MOV     AH,0x00            
    54 00007C7E B2 00                                   MOV     DL,0x00            
    55 00007C80 CD 13                                   INT     0x13                
    56 00007C82 EB E3                                   jmp     retry              
    57 00007C84                                     next:
    58 00007C84 8C C0                                   MOV     AX,ES              
    59 00007C86 05 0020                                 add     ax,0x0020           
    60 00007C89 89 C3                                   MOV     BX,AX               
    61 00007C8B 80 C1 01                                add     CL,1                
    62 00007C8E 80 F9 12                                cmp     CL,18              
    63 00007C91 76 D1                                   jbe     readloop      
    64 00007C93                                         ;反面
    65 00007C93 B1 01                                   MOV     CL,1                
    66 00007C95 80 C6 01                                ADD     DH,1                
    67 00007C98 80 FE 02                                cmp     DH,2                
    68 00007C9B 72 C7                                   jb      readloop            
    69 00007C9D                                         ;读取柱面
    70 00007C9D B6 00                                   MOV     DH,0                
    71 00007C9F 80 C5 01                                ADD     CH,1               
    72 00007CA2 80 FD 0A                                cmp     CH,CYLS             
    73 00007CA5 72 BD                                   jb      readloop
    74 00007CA7                                     success:
    75 00007CA7 0A 0A                                   DB      0x0a,0x0a
    76 00007CA9 45 4E 54 45 52 20 74 68 65 20           db      "ENTER the OS"
       00007CB3 4F 53 
    77 00007CB5 0A                                      db      0x0a
    78 00007CB6 00                                      db      0
    79 00007CB7                                         ; begin to execute os from boot sector
    80 00007CB7 88 2E 0FF0                              mov     [0xff0], ch         
    81 00007CBB E9 4542                                 jmp     0xc200              
    82 00007CBE                                     error:
    83 00007CBE BE 7CD6                                 MOV     si,MSG
    84 00007CC1                                     putloop:
    85 00007CC1 8A 04                                   MOV     al,[si]         
    86 00007CC3 83 C6 01                                add     si,1
    87 00007CC6 3C 00                                   cmp     al,0           
    88 00007CC8                                 
    89 00007CC8 74 09                                   je      fin
    90 00007CCA B4 0E                                   MOV     AH,0x0e        
    91 00007CCC BB 000F                                 MOV     bx,15          
    92 00007CCF CD 10                                   INT     0x10           
    93 00007CD1 EB EE                                   jmp     putloop
    94 00007CD3                                     fin:
    95 00007CD3 F4                                      HLT
    96 00007CD4 EB FD                                   jmp     fin
    97 00007CD6                                     MSG:
    98 00007CD6 0A 0A                                   DB      0x0a,0x0a
    99 00007CD8 4C 4F 41 44 20 45 52 52 4F 52           db      "LOAD ERROR"
   100 00007CE2 0A                                      db      0x0a
   101 00007CE3 00                                      db      0
   102 00007CE4                                         ;判断终止启动区
   103 00007CE4 00 00 00 00 00 00 00 00 00 00           RESB    510-($-$$)          
       00007CEE 00 00 00 00 00 00 00 00 00 00 
       00007CF8 00 00 00 00 00 00 00 00 00 00 
       00007D02 00 00 00 00 00 00 00 00 00 00 
       00007D0C 00 00 00 00 00 00 00 00 00 00 
       00007D16 00 00 00 00 00 00 00 00 00 00 
       00007D20 00 00 00 00 00 00 00 00 00 00 
       00007D2A 00 00 00 00 00 00 00 00 00 00 
       00007D34 00 00 00 00 00 00 00 00 00 00 
       00007D3E 00 00 00 00 00 00 00 00 00 00 
       00007D48 00 00 00 00 00 00 00 00 00 00 
       00007D52 00 00 00 00 00 00 00 00 00 00 
       00007D5C 00 00 00 00 00 00 00 00 00 00 
       00007D66 00 00 00 00 00 00 00 00 00 00 
       00007D70 00 00 00 00 00 00 00 00 00 00 
       00007D7A 00 00 00 00 00 00 00 00 00 00 
       00007D84 00 00 00 00 00 00 00 00 00 00 
       00007D8E 00 00 00 00 00 00 00 00 00 00 
       00007D98 00 00 00 00 00 00 00 00 00 00 
       00007DA2 00 00 00 00 00 00 00 00 00 00 
       00007DAC 00 00 00 00 00 00 00 00 00 00 
       00007DB6 00 00 00 00 00 00 00 00 00 00 
       00007DC0 00 00 00 00 00 00 00 00 00 00 
       00007DCA 00 00 00 00 00 00 00 00 00 00 
       00007DD4 00 00 00 00 00 00 00 00 00 00 
       00007DDE 00 00 00 00 00 00 00 00 00 00 
       00007DE8 00 00 00 00 00 00 00 00 00 00 
       00007DF2 00 00 00 00 00 00 00 00 00 00 
       00007DFC 00 00 
   104 00007DFE 55 AA                                   db      0x55,0xaa           